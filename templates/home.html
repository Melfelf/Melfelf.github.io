{% extends "_base.html" %}

{% block page %}homepage{% endblock page%}
{% block lang %}{% if section.extra.lang %}{{ section.extra.lang }}{% else %}{{ section.lang }}{% endif %}{% endblock lang %}
{% block title %}{{ config.title }}{% endblock title %}
{% block desc %}
  <meta name="description" content="{{ config.description }}">
{% endblock desc %}

{% block head %}
{% if config.markdown.highlight_theme == "css" %}
  {% if config.extra.force_theme == "dark" %}
    <link id="hl" rel="stylesheet" type="text/css" href="{{ get_url(path='hl-dark.css') }}" />
  {% else %}
    <link id="hl" rel="stylesheet" type="text/css" href="{{ get_url(path='hl-light.css') }}" />
  {% endif %}
{% endif %}
{% if section.extra.math %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: true }
            ],
            throwOnError: false
        });
    });
</script>
{% endif %}
{% endblock head %}

{% block content %}
<div id="wrapper">
  <main>
    <section id="logo" class="logo-band">
      <a href="{{ get_url(path='/') }}" class="site-logo" aria-label="MelfWare - Home">
        <img
          src="{{ get_url(path='img/melfware-logo.svg') }}"
          alt="MelfWare - Intelligent Automation"
          class="site-logo-img"
        >
      </a>
      {% if section.extra.overline %}
      <div class="logo-overline">{{ section.extra.overline }}</div>
      {% endif %}
    </section>

    <section id="info" class="hero-panel">
      <div class="hero-main">
        <div class="hero-header">
          <div>
            <span class="eyebrow">Stefan “Melf” Moser</span>
            <div class="name-row">
              <span id="name">{{ section.extra.name }}</span>
              {% if section.extra.id %}
              <span id="id">@{{ section.extra.id }}</span>
              {% endif %}
            </div>
            {% if section.extra.bio %}
            <p id="bio">{{ section.extra.bio }}</p>
            {% endif %}
          </div>
        </div>

        {% if section.extra.highlights %}
        <ul class="highlight-list">
          {% for item in section.extra.highlights %}
          <li>
            <span class="checkmark">•</span>
            <span>{{ item }}</span>
          </li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if section.extra.status_cards %}
        <div class="status-grid">
          {% for stat in section.extra.status_cards %}
          <div class="status-card">
            <span class="label">{{ stat.label }}</span>
            <span class="value">{{ stat.value }}</span>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <div class="link-row">
          <div class="primary-links">
            {% for section in config.extra.sections %}
            <a {% if section.is_external %}href="{{ section.path }}" target="_blank" rel='noreferrer noopener'{% else %}href="{{ get_url(path=section.path) }}" class="instant"{% endif %}>{{ section.name }}</a>
            {% endfor %}
          </div>
          <div class="social-links">
            {% for link in section.extra.links %}
            <a href="{{ link.url }}" aria-label="{{ link.name }}" target="_blank" rel='noreferrer noopener'>
              {% set icon_path = "icon/" ~ link.icon ~ ".svg" %}
              {% set icon = load_data(path=icon_path) %}
              {{ icon | safe }}
            </a>
            {% endfor %}
            {% if not section.extra.footer and not config.extra.force_theme %}
            {% set moon_icon = load_data(path="icon/moon.svg") %}
            {% set sun_icon = load_data(path="icon/sun.svg") %}
            <button id="theme-toggle" aria-label="theme switch">
              <span class="moon-icon">{{ moon_icon | safe }}</span>
              <span class="sun-icon">{{ sun_icon | safe }}</span>
            </button>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="hero-aside">
        {% if section.extra.contact_note %}
        <div class="contact-card">
          <p>{{ section.extra.contact_note }}</p>
          {% if section.extra.links %}
            {% for link in section.extra.links %}
              {% if link.name == "Email" %}
              <a class="button instant" href="{{ link.url }}">Start a conversation</a>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
        {% endif %}
      </div>
    </section>

    <section id="brief" class="prose">
      {{ section.content | trim | safe }}
    </section>

    {% if section.extra.featured_sections %}
    <section class="featured-grid">
      <div class="section-title">
        <p class="eyebrow">Explore</p>
        <h2>Start with a focus area</h2>
      </div>
      <div class="feature-cards">
        {% for item in section.extra.featured_sections %}
        <a class="feature-card instant" href="{{ get_url(path=item.path) }}">
          <div class="card-header">
            <span class="pill">{{ item.name }}</span>
            <span class="arrow">→</span>
          </div>
          <p>{{ item.description }}</p>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% if section.extra.recent %}
    {% set blog_section_path = config.extra.blog_section_path | trim_start_matches(pat="/") %}
    {% set section_md_path = blog_section_path ~ "/_index.md" %}
    {% set blog_section = get_section(path=section_md_path) %}
    <section class="layout-list">
      <div class="post-list">
        {% for post in blog_section.pages | slice(end=section.extra.recent_max) %}
        <a class="post instant {% if post.extra.featured %}featured{% endif %}" href="{{ post.permalink }}">
          <span>{{ post.title }}</span>
          <span class="date">
            {{ post.date | date(format=section.extra.date_format) }}
            {% if post.updated and post.updated != post.date %}
            (updated {{ post.updated | date(format=section.extra.date_format) }})
            {% endif %}
          </span>
        </a>
        {% endfor %}
      </div>
      <div class="read-more">
        <a class="instant" href="{{ config.extra.blog_section_path }}">{{ section.extra.recent_more_text }}</a>
      </div>
    </section>
  {% endif %}
  </main>

  {% if section.extra.footer %}
    {% include "_footer.html" %}
  {% endif %}
</div>
{% endblock content %}

{% block script %}
<script src="{{ get_url(path='js/lightense.min.js') }}"></script>
{% if section.extra.mermaid %}
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>
{% endif %}
{% endblock script %}
